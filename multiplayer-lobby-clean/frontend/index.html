<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monkey's Paw</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f4f4f4; }
  #lobby, #game { max-width: 600px; margin: auto; padding: 20px; background: #fff; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);}
  button { padding: 10px 20px; margin: 5px; cursor: pointer; }
  input, textarea { width: 100%; padding: 8px; margin: 5px 0; }
  #playerList { margin: 10px 0; }
</style>
</head>
<body>

<div id="lobby">
  <h1>Welcome to Monkey's Paw</h1>
  <button id="createLobbyBtn">Create Lobby</button>
  <button id="joinLobbyBtn">Join Lobby</button>
  <div id="lobbyForm" style="display:none;">
    <input type="text" id="lobbyName" placeholder="Enter lobby name">
    <input type="password" id="password" placeholder="Enter password">
    <button id="submitLobbyBtn">Submit</button>
  </div>
</div>

<div id="game" style="display:none;">
  <h2>Game Room</h2>
  <div id="playerList"></div>
  <div id="gamePanel" style="display:none;">
    <p id="roundInfo"></p>
    <p id="wish"></p>
    <div id="submissionArea" style="display:none;">
      <textarea id="curseInput" placeholder="Write your curse here..."></textarea>
      <button id="submitCurseBtn">Submit Curse</button>
    </div>
    <div id="voteArea" style="display:none;"></div>
  </div>
</div>

<script>
const ws = new WebSocket('ws://localhost:3000/ws');

let isWisher = false;
let submissions = [];

const lobbyDiv = document.getElementById('lobby');
const lobbyForm = document.getElementById('lobbyForm');
const gameDiv = document.getElementById('game');
const gamePanel = document.getElementById('gamePanel');
const playerListDiv = document.getElementById('playerList');
const roundInfo = document.getElementById('roundInfo');
const wishPara = document.getElementById('wish');
const submissionArea = document.getElementById('submissionArea');
const curseInput = document.getElementById('curseInput');
const voteArea = document.getElementById('voteArea');

document.getElementById('createLobbyBtn').onclick = () => {
  lobbyForm.style.display = 'block';
};

document.getElementById('joinLobbyBtn').onclick = () => {
  lobbyForm.style.display = 'block';
};

document.getElementById('submitLobbyBtn').onclick = () => {
  const lobbyName = document.getElementById('lobbyName').value;
  const password = document.getElementById('password').value;
  const action = lobbyName && password ? 'create_lobby' : 'join_lobby';
  ws.send(JSON.stringify({ type: action, lobbyName, password }));
};

ws.onmessage = (event) => {
  const msg = JSON.parse(event.data);
  switch(msg.type){
    case 'error':
      alert(msg.message);
      break;
    case 'created':
    case 'joined':
      lobbyDiv.style.display = 'none';
      gameDiv.style.display = 'block';
      break;
    case 'lobby_update':
      playerListDiv.innerHTML = 'Players: ' + msg.lobby.players.map(p => p.name + ' (' + p.score + ')').join(', ');
      break;
    case 'game_started':
      gamePanel.style.display = 'block';
      roundInfo.textContent = 'Round ' + msg.round;
      break;
    case 'wish_drawn':
      wishPara.textContent = 'Wish: ' + msg.wish;
      submissionArea.style.display = 'block';
      isWisher = true;
      break;
    case 'reveal':
      voteArea.style.display = 'block';
      voteArea.innerHTML = '';
      submissions = msg.submissions;
      submissions.forEach((c, i) => {
        const btn = document.createElement('button');
        btn.textContent = c;
        btn.onclick = () => ws.send(JSON.stringify({ type: 'vote', curseIndex: i }));
        voteArea.appendChild(btn);
      });
      break;
    case 'new_round':
      roundInfo.textContent = 'Round ' + msg.round;
      submissionArea.style.display = msg.isWisher ? 'block' : 'none';
      voteArea.style.display = 'none';
      wishPara.textContent = '';
      isWisher = msg.isWisher;
      break;
    case 'round_finished':
      alert(msg.winner + ' won this round! New score: ' + msg.score);
      break;
  }
};

document.getElementById('submitCurseBtn').onclick = () => {
  const curse = curseInput.value;
  if(curse) {
    ws.send(JSON.stringify({ type: 'submit_curse', curse }));
    submissionArea.style.display = 'none';
    curseInput.value = '';
  }
};
</script>
</body>
</html>
